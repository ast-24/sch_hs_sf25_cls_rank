# 要件定義書

## 機能要件

プレイヤー及び各プレイヤーのスコアを管理する

### 入力

スタッフが1問ごとに正解/不正解を入力し送信を行う  
プレイヤー識別子:ラウンド番号:問題番号:正解/不正解の形式

[スコア計算方式]

- 初期スコア: 0
- 負のスコア: 許可（下限なし）
- 連続判定: 同一ラウンド内の連続する問題で判定(ラウンドはまたがない)
- 計算式: `スコア = 前回の結果 + ( 正解 ? +100 : -500 ) * 連続[正解/不正解]数`

パスはスコアには影響しないが、連続判定は切れる

[プレイヤー識別子]  
`プレイヤーID = ルームID(1~3)-通し番号(xxx)`

#### ラウンド

プレイヤーの1回の来訪を1ラウンドとし、1ラウンドに対して複数の問題を解くことができる

過去のラウンドを含めた履歴の編集(insert/update/delete)も一応実装が必要  
ラウンドは最後の結果から一定時間経過していれば閉じられないまま終了したとみなす  
ラウンドは終了を管理するのではなく開始を管理するのがよいのではないか  
開始時にラウンドIDを新規発行するか選択するのと、ランクには途中でもうリアルタイムで反映

### 表示(ランキング)

- 累積スコア（total）
- 1ラウンド当たりのスコア（round）
- プレイヤー別最大ラウンドスコア（round_max）
- ルーム別最新ラウンドスコア（round_latest）

最新ラウンドランキングは5分以内に終了したラウンドのみを対象とする

ランキング更新や30秒ごとのポーリングエンドポイントを用意する

ランキングページは2通り用意する

1. 教室内表示用（インタラクティブモード）  
   こちらは表示端末直接操作依存の 待機→3ルームランク→全体ランク という遷移でいい
2. 教室外表示用（ビューオンリーモード）  
   こちらはポーリングによる全体ランク自動更新を行う

## 企画詳細

### 企画団体

2年1組

### イベント

2025年度文化祭

### 企画名

坂井の人事

### 概要

来場者がクイズに挑戦し、正解・不正解・パスの結果に応じてスコアが変動するランキングシステム。
連続正解・連続不正解により得点・減点が増倍されるリスク&リワード要素を含む。

### プレイヤー体験

1. 3つのルーム（教室前方・中央・後方）のいずれかでクイズに挑戦
2. プレイヤーIDを発行または既存IDを提示
3. スタッフが問題を出題し、プレイヤーが回答
4. 正解・不正解・パスの結果をスタッフが入力
5. ラウンド終了後、統計情報を確認可能
6. リアルタイムでランキングに反映
7. 3ルームのラウンドが終了したらスタッフが結果発表

### ランキング表示

- **教室内掲示用（インタラクティブモード）**: 結果発表時にスタッフが操作
- **教室外掲示用（ビューオンリーモード）**: 常時掲示、自動更新

## 非機能要件

### スケーラビリティ

スタッフ x 3人 + ランキング表示端末 x 2台 が捌ければ充分

### 可用性/保守性

文化祭中だけ動けばよい

### セキュリティ

URL自体が露出しないうえ、想定される攻撃目的がチートのみであるため最低限

- プレイヤー識別子被せ対策  
  表示名と識別子を分離することで対策済み  
  ただし連番であり予測可能であるため微妙  
  採番方式を変更する必要があるかもしれない

※入力APIの認証機能については実装検討中

### コスト

基本的に無料枠を利用する  
安価であれば申請次第で多少はコストをかけてもよい可能性がある
