# 要件定義書

## 機能要件

ユーザ及び各ユーザのスコアを管理する

### 入力

スタッフが1問ごとに正解/不正解を入力し送信を行う  
ユーザ識別子:ラウンド番号:問題番号:正解/不正解の形式

[スコア計算方式]

- 初期スコア: 0
- 負のスコア: 許可（下限なし）
- 連続判定: 同一ラウンド内の連続する問題で判定(ラウンドはまたがない)
- 計算式: `スコア = 前回の結果 + ( 正解 ? +100 : -500 ) * 連続[正解/不正解]数`

パスはスコアには影響しないが、連続判定は切れる

[ユーザ識別子]  
`ユーザID = ルームID(1~3)-通し番号(xxx)`

#### ラウンド

ユーザの1回の来訪を1ラウンドとし、1ラウンドに対して複数の問題を解くことができる

過去のラウンドを含めた履歴の編集(insert/update/delete)も一応実装が必要  
ラウンドは最後の結果から一定時間経過していれば閉じられないまま終了したとみなす  
ラウンドは終了を管理するのではなく開始を管理するのがよいのではないか  
開始時にラウンドIDを新規発行するか選択するのと、ランクには途中でもうリアルタイムで反映

### 表示(ランキング)

- 累積スコア（total）
- 1ラウンド当たりのスコア（round）
- ユーザ別最大ラウンドスコア（round_max）
- ルーム別最新ラウンドスコア（round_latest）

各ランキングは最大30件まで表示する

最新ラウンドランキングは5分以内に終了したラウンドのみを対象とする

ランキング更新や30秒ごとのポーリングエンドポイントを用意する

ただしランキング更新はそれで完全にできるとは限らないから1分ごとにリフレッシュする

ランキングページは2通り用意する

1. 教室内表示用（インタラクティブモード）  
   こちらは表示端末直接操作依存の 待機→3ルームランク→全体ランク という遷移でいい
2. 教室外表示用（ビューオンリーモード）  
   こちらはポーリングによる全体ランク自動更新を行う

## 非機能要件

### スケーラビリティ

スタッフ x 3人 + ランキング表示端末 x 2台 が捌ければ充分

### 可用性/保守性

文化祭中だけ動けばよい

### セキュリティ

URL自体が露出しないうえ、想定される攻撃目的がチートのみであるため最低限

- ユーザ識別子被せ対策  
  表示名と識別子を分離することで対策済み  
  ただし連番であり予測可能であるため微妙

※入力APIの認証機能については実装検討中

### コスト

基本的に無料枠を利用する  
安価であれば申請次第で多少はコストをかけてもよい可能性がある
